<ion-header>
  <ion-toolbar color="tertiary">
    <ion-title>ğŸ§¾ Harvester Bill</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Bill Card to be captured -->
  <div #billCard id="bill-card" class="bill-card">
    <div class="bill-header">
      <img src="assets/images/harvester_logo.avif" alt="Harvester Logo" />
      <h2>ğŸŒ¾ Harvester Meter Receipt</h2>
      <p class="small">Generated automatically by Harvester App</p>
    </div>

    <div class="bill-body">
      <p><b>ğŸ§‘â€ğŸŒ¾ Farmer:</b> {{ farmerName || 'â€”' }}</p>
      <p><b>ğŸ“ Mobile:</b> {{ mobile || 'â€”' }}</p>
      <p><b>ğŸ“ Address:</b> {{ address || 'â€”' }}</p>
      <p><b>ğŸï¸ Field:</b> {{ fieldName || 'â€”' }}</p>

      <div class="timeline-section">
        <h3>ğŸ• Work Timeline</h3>
        <table class="timeline-table">
          <tr>
            <td><b>Start Time</b></td>
            <td>{{ startTime || 'â€”' }}</td>
          </tr>
          <ng-container *ngIf="stopPeriods.length > 0">
            <tr>
              <td colspan="2" class="table-divider">Stop Periods</td>
            </tr>
            <tr *ngFor="let stop of stopPeriods; index as i">
              <td>Stop {{ i + 1 }}</td>
              <td>{{ stop.start }} â†’ {{ stop.end }}</td>
            </tr>
          </ng-container>
          <tr>
            <td><b>End Time</b></td>
            <td>{{ endTime || 'â€”' }}</td>
          </tr>
          <tr class="highlight">
            <td><b>Total Active Time</b></td>
            <td>{{ totalHours | number:'1.2-2' }} hrs</td>
          </tr>
        </table>
      </div>

      <div class="amount-section">
        <table class="amount-table">
          <tr>
            <td>ğŸ’° Rate / Hour</td>
            <td><b>â‚¹{{ ratePerHour }}</b></td>
          </tr>
          <tr>
            <td>ğŸ“„ Total Amount</td>
            <td><b class="amount">â‚¹{{ totalAmount | number:'1.0-2' }}</b></td>
          </tr>
        </table>
      </div>
    </div>

    <div class="bill-footer">
      <hr />
      <p class="small">Thank you for using <b>Harvester Meter</b> ğŸŒ¾</p>
      <p class="small">Date: {{ today | date:'mediumDate' }}</p>
    </div>
  </div>


<!-- Farmer name with mic -->
<ion-item>
  <ion-label position="stacked">ğŸ§‘â€ğŸŒ¾ Farmer Name</ion-label>
  <div class="input-with-mic">
    <ion-input [(ngModel)]="farmerName" placeholder="Enter farmer name"></ion-input>
    <ion-button
      fill="clear"
      color="success"
      (click)="recordFarmerName()"
      [disabled]="isFarmerListening || isAddressListening">
      ğŸ™
    </ion-button>
  </div>
</ion-item>

<!-- Address with mic -->
<ion-item>
  <ion-label position="stacked">ğŸ“ Address / Village</ion-label>
  <div class="input-with-mic">
    <ion-input [(ngModel)]="address" placeholder="Enter address / village"></ion-input>
    <ion-button
      fill="clear"
      color="success"
      (click)="recordAddress()"
      [disabled]="isFarmerListening || isAddressListening">
      ğŸ™
    </ion-button>
  </div>
</ion-item>



  <ion-list>
    <ion-item>
      <ion-label position="stacked">ğŸ“ Mobile Number</ion-label>
      <ion-input [(ngModel)]="mobile" placeholder="Enter farmer mobile"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">ğŸŒ¾ Field Name</ion-label>
      <ion-input [(ngModel)]="fieldName" placeholder="Optional"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">ğŸ’° Rate / Hour (â‚¹)</ion-label>
      <ion-input type="number" [(ngModel)]="ratePerHour" (ionInput)="calculate()" (ionBlur)="saveRate()">
      </ion-input>
    </ion-item>
  </ion-list>

  <!-- Two flows: Native Share (image) & WhatsApp text -->
  <ion-button expand="block" color="success" size="large" (click)="shareBill('native')">
    ğŸ“¤ Share Bill (Image)
  </ion-button>

  <ion-button expand="block" color="tertiary" (click)="shareBill('whatsapp')">
    ğŸ’¬ Send to Farmer (WhatsApp)
  </ion-button>

  <ion-button expand="block" color="medium" (click)="goToHistory()">
    ğŸ“š View Bill History
  </ion-button>

  <ion-button expand="block" color="medium" (click)="goHome()">
    â¬…ï¸ Back to Home
  </ion-button>
</ion-content>
